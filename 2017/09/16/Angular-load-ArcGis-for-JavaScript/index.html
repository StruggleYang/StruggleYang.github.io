<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="StruggleYang  struy"><title>Angular(4)中加载Arcgis for JavaScript地图 | struy</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Angular(4)中加载Arcgis for JavaScript地图</h1><a id="logo" href="/.">struy</a><p class="description">你看到的世界就是你自己的样子！</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/soul/"><i class="fa fa-wifi"> 午后</i></a><a href="/tools/"><i class="fa fa-wrench"> 红茶</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a><a href="/collect"><i class="fa fa-rss"> collect</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Angular(4)中加载Arcgis for JavaScript地图</h1><div class="post-meta">Sep 16, 2017</div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#背景"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#寻"><span class="toc-number">2.</span> <span class="toc-text">寻</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#雾"><span class="toc-number">3.</span> <span class="toc-text">雾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#差"><span class="toc-number">4.</span> <span class="toc-text">差</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#花"><span class="toc-number">5.</span> <span class="toc-text">花</span></a></li></ol></div></div><div class="post-content"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><blockquote>
<p>近期我司项目的需要，采用Angular(4)+SpringBoot前后端分离的架构。并且在需要在项目中实现Arcgis地图。  </p>
</blockquote>
<h2 id="寻"><a href="#寻" class="headerlink" title="寻"></a>寻</h2><p>像我这种菜鸡遇到这种没有干过的事情肯定是先问百度和谷歌,两个关键词敲下。几乎搜索的内容里很少有两个关键字共存的。但是我这慧眼识得好代码，于是发现了这: <a href="https://github.com/Esri/angular-esri-map" target="_blank" rel="noopener">https://github.com/Esri/angular-esri-map</a></p>
<p>Esri是美国环境系统研究所公司,多年来，ESRI公司始终将GIS视为一门科学.也就是说这是官方实例呀。</p>
<a id="more"></a>
<p>这样就完了吗？不，事情总是没那么简单的。我以负八级的英文水平开始看这个项目的README,第一行。心都碎了[手动心碎]他是这样说的。</p>
<blockquote>
<p>A collection of directives to help you use Esri maps and services in your AngularJS v1.x applications.</p>
</blockquote>
<p>wtf?==&gt;AngularJS v1.x applications，我的项目用的可是4.x，这不扯淡？</p>
<p>继续遨游在GayHub[手动滑稽]的代码海洋里。皇天不负有心人让我找到了他:<br><a href="https://github.com/tomwayson/angular2-esri-example" target="_blank" rel="noopener">https://github.com/tomwayson/angular2-esri-example</a></p>
<p>在这里我尝试将他的项目clone到本地，的确可以跑起来，并且可以看到地图,但尝试获取核心代码但是在包下载的时候就出现了很多问题于是放弃了[真的是无限差包]。</p>
<h2 id="雾"><a href="#雾" class="headerlink" title="雾"></a>雾</h2><p>因为之前看到是2.x版本就机遇尝试便没有仔细阅读本项目的说明文档。回去看他的说明文档并把<code>Resources</code>节点下的东西都挨个看了一遍,发现了其中一项貌似很有用：</p>
<ul>
<li><a href="https://github.com/tomwayson/esri-angular-cli-example" target="_blank" rel="noopener">Example of how to use the ArcGIS API for JavaScript in an angular-cli application</a></li>
<li>【译】如何在 Angular CLI 程序中使用ArcGIS API for JavaScript的示例</li>
</ul>
<p>于是开始阅读这个示例的说明文档，他在文中提到:</p>
<blockquote>
<p>This repository is an example of one way to use the ArcGIS API for JavaScript in an application generated with angular-cli.<br>此存储库是在使用angular-cli生成的应用程序中使用ArcGIS API for JavaScript的一种方法的示例</p>
</blockquote>
<p>还有一句:</p>
<blockquote>
<p>Adding the ArcGIS API to your own angular-cli application<br>将ArcGIS API添加到您自己的Angular-cli应用程序</p>
<p>Rather than clone this repository, you should create your own application with the angular-cli and then follow the instructions below to add the above libraries:<br>而不是克隆此存储库，您应该使用angular-cli创建自己的应用程序，然后按照以下说明添加以上库：</p>
</blockquote>
<p>下面的是说明：</p>
<ul>
<li><a href="https://github.com/tomwayson/angular-esri-loader/blob/master/README.md#in-an-angular-cli-application" target="_blank" rel="noopener">angular2-esri-loader</a> - a low level service needed to load and use ArcGIS modules (v3.x or v4.x) in your Angular applications<ul>
<li>在Angular应用程序中加载和使用ArcGIS模块（v3.x或v4.x）所需的低级服务</li>
</ul>
</li>
<li><a href="https://github.com/TheKeithStewart/angular-esri-components#setup" target="_blank" rel="noopener">angular-esri-components</a> - a set of reusable components for use with v4.x (only) of the ArcGIS API<ul>
<li>一组（仅）可用于ArcGIS API v4.x的可重用组件</li>
</ul>
</li>
</ul>
<hr>
<p>上面的意思已经很清楚。这个项目不建议clone，而是使用angular2-esri-loader 来加载ArcGIS模块，angular-esri-components组件是只能在Arcgis4.x版本中使用的。</p>
<p>当点开<a href="https://github.com/tomwayson/angular-esri-loader/blob/master/README.md#in-an-angular-cli-application" target="_blank" rel="noopener">angular2-esri-loader</a>这个模块的时候，会很清楚的看到如何安装这个Angular的gis加载库，并且写了示例程序。对于angular有一定的了解的话，这些代码或许就能很清晰的表达出它在做什么。</p>
<p>示例的代码就不列出，可以到github上阅读。大体流程是：</p>
<ul>
<li>npm安装<a href="https://github.com/tomwayson/angular-esri-loader" target="_blank" rel="noopener">angular-esri-loader</a>,Angular版本不同则安装的命令和库也会存在差异</li>
<li>EsriLoaderModule模块加载到程序中</li>
<li>使用EsriLoaderService组件加载地图</li>
<li>文档中加载的是基础图层，但一般开发时会加载缓存地图服务或者其他类型地图服务。这将在我的的示例项目中看到</li>
</ul>
<p>项目示例:<br><a href="https://git.oschina.net/StruggleYang/ngGisDemo" target="_blank" rel="noopener">https://git.oschina.net/StruggleYang/ngGisDemo</a></p>
<p>项目效果:  </p>
<p><img src="http://www.struy.top/17-9-16/48529141.jpg" alt=""></p>
<h2 id="差"><a href="#差" class="headerlink" title="差"></a>差</h2><p>你如果看过Arcgis for JavaScript的代码。那么JavaScript代码，如何转换为Angular(TypeScript)的代码，这里我也没有做过多的了解，只是照葫芦画瓢写的一些:  </p>
<p>这里推荐去看一下阮一峰的:<a href="http://es6.ruanyifeng.com/" target="_blank" rel="noopener">ES6标准入门</a>可以提供一些参考  </p>
<p>下面将做出原生的Arcgis for JavaScript代码和Angular中的书写对比。</p>
<p>变量声明：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 有可能你需要在地图初始化前首先声明变量，以便你在任何地方都是可用的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> map; <span class="comment">// js</span></span><br><span class="line"></span><br><span class="line">map: any; <span class="comment">// ts</span></span><br></pre></td></tr></table></figure>
<p>地图的模块加载，Arcgis的api是基于dojo框架的，如下:</p>
<ul>
<li>JavaScript中加载地图模块</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>([<span class="string">"esri/map"</span>, <span class="string">"dojo/domReady!"</span>], <span class="function"><span class="keyword">function</span>(<span class="params">Map</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>(<span class="string">"map"</span>, &#123;</span><br><span class="line">    center: [<span class="number">-118</span>, <span class="number">34.5</span>],</span><br><span class="line">    zoom: <span class="number">8</span>,</span><br><span class="line">    basemap: <span class="string">"topo"</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>Angular中加载地图(基于angular-esri-loader加载器)<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里代码并不全，具体请查看上面的示例项目</span></span><br><span class="line">.. 省略导入</span><br><span class="line"></span><br><span class="line"><span class="meta">@ViewChild</span>(<span class="string">'map'</span>) mapEl: ElementRef;</span><br><span class="line"> map: <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line"> ngOnInit() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.esriLoader.load(&#123;</span><br><span class="line">    <span class="comment">// 在js中是不管这个url的，因为它在html中已经引入对应的版本</span></span><br><span class="line">      url: <span class="string">'//js.arcgis.com/3.18/'</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.esriLoader.loadModules([<span class="string">'esri/map'</span>]).then(<span class="function">(<span class="params">[Map]</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.map = <span class="keyword">new</span> Map(<span class="keyword">this</span>.mapEl.nativeElement, &#123;</span><br><span class="line">          center: [<span class="number">-118</span>, <span class="number">34.5</span>],</span><br><span class="line">          zoom: <span class="number">8</span>,</span><br><span class="line">          basemap: <span class="string">'topo'</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>dojo事件添加:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// dojo点击事件添加 by JavaScript</span></span><br><span class="line">dojo.connect(map, <span class="string">'onClick'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> emp = evt.mapPoint;</span><br><span class="line">    <span class="keyword">var</span> cur_wkid = emp.spatialReference.wkid; </span><br><span class="line">    ... more code</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">// dojo点击事件添加 by Angular</span></span><br><span class="line">dojo.connect(<span class="keyword">this</span>.map, <span class="string">'onClick'</span>, (evt) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> emp = evt.mapPoint;</span><br><span class="line">    <span class="keyword">const</span> cur_wkid = emp.spatialReference.wkid; </span><br><span class="line">    ... more code</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>这里实际上就是一个箭头函数的区别还有变量的声明区别。</p>
<h2 id="花"><a href="#花" class="headerlink" title="花"></a>花</h2><p>这就结束了？</p>
<p>不不不，远远还不只这些。不论是Angular还是Arcgis,很多东西都没有做过多的了解和深入。不知道那行代码存在隐患。所以革命尚未成功，还得加倍学习和实践巩固。</p>
</div><div class="tags"><a href="/tags/Angular/">Angular</a><a href="/tags/WebGis/">WebGis</a><a href="/tags/Arcgis-for-JavaScript/">Arcgis for JavaScript</a><a href="/tags/地图/">地图</a></div><div class="post-nav"><a class="pre" href="/2018/01/06/scala-function-5w/">scala函数的演变过程,函数式的优点</a><a class="next" href="/2017/09/09/hexo-all-update-by-shell/">一个命令,解决hexo多机更新操作</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://git66.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/函数式编程/" style="font-size: 15px;">函数式编程</a> <a href="/tags/dapeng/" style="font-size: 15px;">dapeng</a> <a href="/tags/Angular/" style="font-size: 15px;">Angular</a> <a href="/tags/WebGis/" style="font-size: 15px;">WebGis</a> <a href="/tags/Arcgis-for-JavaScript/" style="font-size: 15px;">Arcgis for JavaScript</a> <a href="/tags/地图/" style="font-size: 15px;">地图</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/influxdb/" style="font-size: 15px;">influxdb</a> <a href="/tags/时序数据库/" style="font-size: 15px;">时序数据库</a> <a href="/tags/github-pages/" style="font-size: 15px;">github-pages</a> <a href="/tags/blog/" style="font-size: 15px;">blog</a> <a href="/tags/vue-js/" style="font-size: 15px;">vue.js</a> <a href="/tags/scala/" style="font-size: 15px;">scala</a> <a href="/tags/随记/" style="font-size: 15px;">随记</a> <a href="/tags/记录/" style="font-size: 15px;">记录</a> <a href="/tags/随笔/" style="font-size: 15px;">随笔</a> <a href="/tags/电影/" style="font-size: 15px;">电影</a> <a href="/tags/DDD/" style="font-size: 15px;">DDD</a> <a href="/tags/领域驱动设计/" style="font-size: 15px;">领域驱动设计</a> <a href="/tags/领域事件/" style="font-size: 15px;">领域事件</a> <a href="/tags/eventbus/" style="font-size: 15px;">eventbus</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/版本控制/" style="font-size: 15px;">版本控制</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/ubuntu/" style="font-size: 15px;">ubuntu</a> <a href="/tags/笔记/" style="font-size: 15px;">笔记</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/12/10/dapeng-build-center-essay/">dapeng构建中心随记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/15/vue-life/">vue实例生命周期</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/26/maven-plugins-use/">maven常用插件使用范例</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/28/wu-wen-xi-dong/">无问西东</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/28/tscompose-bai-hua/">白话tscompose</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/30/influxdb-commons-action/">influxdb常用操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/16/eventbus-archtech-0316/">事件总线EventBus实现架构原理分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/10/DDD-event-bus/">领域事件及事件总线EventBus使用实践</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/06/scala-function-5w/">scala函数的演变过程,函数式的优点</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/16/Angular-load-ArcGis-for-JavaScript/">Angular(4)中加载Arcgis for JavaScript地图</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.itjava.top" title="枫叶博客" target="_blank">枫叶博客</a><ul></ul><a href="https://www.teng.im" title="天山揽月" target="_blank">天山揽月</a><ul></ul><a href="https://www.legic.xyz" title="Legend魔法馆" target="_blank">Legend魔法馆</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">struy.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>